#!/usr/bin/env bash

set -euo pipefail

readonly SCRIPT_DIR_PATH="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

readonly baseDirPath=$(realpath -e "$SCRIPT_DIR_PATH"/..)
readonly phpUnitBinDirPath="$baseDirPath/vendor/phpunit/phpunit"
readonly phpUnitBinFilePath="$phpUnitBinDirPath/phpunit"
readonly testDirPath="$baseDirPath/test"
readonly phpUnitConfFilePath="$testDirPath/phpunit.xml"
readonly seleniumLogFilePath="$testDirPath/selenium.log"
export SELENIUM_VERSION=latest

php -f "$phpUnitBinFilePath" -- --fail-on-warning --fail-on-risky $([[ -n "${MORPHO_CI-}" ]] && echo "--debug --log-junit $testDirPath/result/test.xml") -c "$phpUnitConfFilePath" "$@"
