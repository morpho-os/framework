#!/usr/bin/env bash

set -euo pipefail

readonly SCRIPT_DIR_PATH="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
readonly SCRIPT_FILE_NAME="$(basename "$0")"
readonly SCRIPT_FILE_PATH="$SCRIPT_DIR_PATH/$SCRIPT_FILE_NAME"

readonly baseDirPath=$(realpath -e "$SCRIPT_DIR_PATH"/..)
readonly phpunitBinDirPath="$baseDirPath/vendor/phpunit/phpunit"
readonly phpunitBinFilePath="$phpunitBinDirPath/phpunit"
readonly testDirPath="$baseDirPath/test"
readonly phpunitConfFilePath="$testDirPath/phpunit.xml"
#readonly seleniumLogFilePath="$testDirPath/selenium.log"
#export SELENIUM_VERSION=latest

readonly phpunit="php -f ""$phpunitBinFilePath"" -- -c ""$phpunitConfFilePath"$([[ -n "${MORPHO_CI-}" ]] && echo " --debug --log-junit $testDirPath/result/test.xml")

# todo: uncomment after solving the #8.
#$phpunit --stop-on-warning --stop-on-failure --stop-on-error --stop-on-skipped --stop-on-incomplete --stop-on-risky --fail-on-incomplete --fail-on-risky --fail-on-skipped --fail-on-warning "$@"
$phpunit --stop-on-warning --stop-on-failure --stop-on-error --stop-on-risky --fail-on-risky --fail-on-skipped --fail-on-warning "$@"
