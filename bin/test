#!/usr/bin/env bash

set -euo pipefail

#SCRIPT_FILE_NAME="$(basename "$0")"
SCRIPT_DIR_PATH="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
#SCRIPT_FILE_PATH="$SCRIPT_DIR_PATH/$SCRIPT_FILE_NAME"

baseDirPath="$SCRIPT_DIR_PATH/.."
phpUnitBinDirPath="$baseDirPath/vendor/phpunit/phpunit"
phpUnitBinFilePath="$phpUnitBinDirPath/phpunit"
testDirPath="$baseDirPath/test"
phpUnitConfigFilePath="$testDirPath/phpunit.xml"
seleniumLogFilePath="$testDirPath/selenium.log"

#$phpUnitBinFilePath --version

export SELENIUM_VERSION=latest

php -f $phpUnitBinFilePath -- --fail-on-warning --fail-on-risky $([[ -n "${TRAVIS-}" ]] && echo "--debug --log-junit $testDirPath/result/test.xml") -c "$phpUnitConfigFilePath" "$@" || {
    if [[ -n ${TRAVIS:-} ]]; then
        echo ---------------------------------------------------------------
        echo Selenium log:
        echo ---------------------------------------------------------------
        [[ -f "$seleniumLogFilePath" ]] && cat "$seleniumLogFilePath"
    fi
    exit 1
}
